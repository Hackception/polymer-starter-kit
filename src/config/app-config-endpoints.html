<script>

  AppEndpoints = {
    apiBase: {
      protocol: 'https:',
      subdomain: 'subdomain',
      apiSuffix: 'api',
      domain: 'domain.com'
    }
  };

  function resolveApiBaseUrl() {
    const config = AppEndpoints.apiBase;
    let { protocol, port } = window.location;
    let [ subdomain, ...domain] = window.location.hostname.split('.');

    // Handle vanity domains (no subdomain)
    if (domain.length && !domain.includes('.')) {
      domain.unshift(subdomain);
      subdomain = config.apiSuffix;
    }
    // Handle localhost
    else if (!domain.length) {
      domain = [subdomain];
      subdomain = '';
    }
    domain = domain.join('.');


    if (domain.includes('localhost')) {
      // No subdomain, use the supplied one
      if (!subdomain) { subdomain = config.subdomain; }

      // Swap the protocol, domain and port
      domain = config.domain;
      protocol = '';
      port = '';

      // If there's no protocol, use the default
      if (!protocol) { protocol = config.protocol; }
    }

    // Add -api if it's missing
    if (!subdomain.endsWith(config.apiSuffix)) {
      subdomain.concat(`-${config.apiSuffix}`);
    }

    AppEndpoints.apiBaseUrl = `${protocol}//${subdomain}.${domain}${port}`;
  }

  resolveApiBaseUrl();

  AppConfigs.endpoints = AppEndpoints;

</script>
