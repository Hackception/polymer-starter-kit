<script>

  AppEndpoints = {
    apiBase: {
      protocol: 'https://',
      subdomain: 'subdomain',
      apiSuffix: 'api',
      domain: 'domain.com'
    }
  };

  function resolveApiBaseUrl() {
    const config = AppEndpoints.apiBase;
    let { protocol, port } = window.location;
    let [ subdomain, ...domain] = window.location.hostname.split('.');

    // Handle vanity domains (no subdomain)
    if (!domain.includes('.')) {
      domain.unshift(subdomain);
      subdomain = config.apiSuffix;
    }

    domain = domain.join('.');


    if (domain.includes('localhost')) {
      // No subdomain, use the supplied one
      if (!subdomain) { subdomain = config.subdomain; }

      // Swap the protocol, domain and port
      domain = config.domain;
      delete protocol;
      delete port;

      // If there's no protocol, use the default
      if (!protocol) { protocol = config.protocol; }
    }

    // Add -api if it's missing
    else if (!subdomain.endsWith(config.apiSuffix) {
      subdomain.concat(`-${config.apiSuffix}`);
    }

    config.apiBaseUrl = `${protocol}${subdomain}.${domain}${port}`;
  }

  resolveApiBaseUrl();

  AppConfigs.endpoints = AppEndpoints;

</script>
